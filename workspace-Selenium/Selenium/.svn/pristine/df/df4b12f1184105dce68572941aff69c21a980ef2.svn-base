package TST_210_Cadastrar_Grupo_de_Usuarios_Visitantes;


import org.junit.*;

import static org.junit.Assert.*;

import org.openqa.selenium.*;
import org.openqa.selenium.support.ui.Select;

import br.com.specto.arquivo.debug.LogDebug;
import br.com.specto.arquivo.test.result.LogTestResult;
import br.com.specto.auxiliar.MetodosAuxiliares;
import br.com.specto.entidades.GrupoDeUsuariosVisitantes;


public class TST_210_03_CadastrarGrupoDeUsuariosVisitantes {
  
	private WebDriver driver;
	private StringBuffer verificationErrors = new StringBuffer();
	private GrupoDeUsuariosVisitantes grupoDeUsuariosVisitantes;
	private MetodosAuxiliares metodosAuxiliares;
	private LogDebug loggerDebug;
	private LogTestResult loggerTestResult;
	
	
	@Before
	public void setUp() throws Exception {
		
		this.grupoDeUsuariosVisitantes = new GrupoDeUsuariosVisitantes();
		this.metodosAuxiliares = new MetodosAuxiliares();
		this.loggerDebug = new LogDebug(this.getClass());
		this.loggerTestResult = new LogTestResult(this.getClass());
    
	}

	
	@Test
	public void cadastrarGrupoUsuariosVisitantesVisact() throws Exception {
		
		loggerDebug.debug("Teste Iniciado");
		    
		try{
			
			driver = metodosAuxiliares.executaLoginManual();
        
			driver.findElement(By.id("mainMenu_ami0-header")).click();			
			driver.findElement(By.id("menuUserGroup_tmi0-title")).click();
			driver.findElement(By.linkText("Usuários Visitantes")).click();
			   
			driver.findElement(By.xpath("//*[ contains(@title, 'Incluir')]")).click();
					
			//Inserindo os dados para o cadastro de Grupo de Ambiente
			driver.findElement(By.name("name")).sendKeys(grupoDeUsuariosVisitantes.getNome());
			driver.findElement(By.name("description")).sendKeys(grupoDeUsuariosVisitantes.getDescricao());
						
			new Select(driver.findElement(By.name("schedule"))).selectByVisibleText(grupoDeUsuariosVisitantes.getGradeDeHorario());
			
			/*Seleciona a Localidade Banco Siamez
		    Muitos problemas para conseguir selecionar a Localidade Banco Siamez. EM outras telas estava conseguindo setar a Localidade pelo endereço xphat
			Porem nesta tela não consegui, pesquisei muito, tentei de várias formas, mas não consegui utilizar uma meneira mais simples que a implementada abaixo.
			Os ids de cada nó são formados somente por números e são gerados de forma aleatória pelo sistema.
			Após a tela aberta pego todos os elementos divs (Cada Nó da árvore é uma DIV) e jogo em um array de elementos.
			Como nesta tela somente os ids desses nós são formados por números, monto uma lista de números, que são os nós.
			Com esta lista, tenho os ids gerados de forma dinâmica e consigo setar o elemento que eu quero com base nesse id, sabendo a ordem que os elementos estão na árvore
			*/
		
			//No dia seguinte, quando fui implementar o teste para edição, o caminho do xpaht funcionou!!!!!!!!!!!!!!!!!
			//Assim voltei neste teste e a gambiarra que tinha sido feita não precisa, porém val deixar documentado para que caso não funcione, possa restabelece-la novamente
			/*String idLocalidadeBancoSiamez = metodosAuxiliares.encontraIdDinamicoDivs();
			
			//Setando a Localidade Banco Siamez na árvore
			driver.findElement(By.id(idLocalidadeBancoSiamez)).click();
			*/ 
		
			//Seleciona a Localidade Banco Siamez
			//Sbstitui a gambiarra acima
			driver.findElement(By.xpath("/html/body/div[3]/div[6]/div[3]/div[3]/table/tbody/tr/td/div[2]/form/div[5]/table/tbody/tr/td[1]/div/div/table/tbody/tr/td/span/span/span[1]/span/span/table/tbody/tr/td[2]/div")).click();
			
			//Botão Salvar do cadastro de Grupo
			driver.findElement(By.xpath("//*[ contains(@title, 'Salvar')]")).click();
						   
			//capturando a mensagem de validação após salvar o Grupo
			String msgRetornadaInterface = driver.findElement(By.xpath("/html/body/div[3]/div[6]/div[3]/div[2]/div/table/tbody/tr/td[2]")).getText();
 			String msgEsperada = "Grupo de Usuários Visitantes [" + grupoDeUsuariosVisitantes.getNome() + "] salvo com sucesso!";
		
			try{
				
				//validando a mensagem de validação
				assertEquals(msgEsperada, msgRetornadaInterface);	    
				loggerTestResult.testResult("Aprovado");
				
			}catch (AssertionError erroValidaMensagemCadastroGrupoDeUsuariosVisitantes){
    		
				loggerDebug.debug("Erro ao Executar o caso de Teste: " + erroValidaMensagemCadastroGrupoDeUsuariosVisitantes);
    			loggerTestResult.testResult("Reprovado");
    			
    			//Avisa a api junit sobre o erro no caso de teste
    			throw erroValidaMensagemCadastroGrupoDeUsuariosVisitantes;
    	
    		}finally{
    
				//fechar a tela de cadastro do Grupo
				driver.findElement(By.xpath("//*[contains(@title, 'Fechar')]")).click();
						
				//fechando a janela da lista dos ambientes cadastrados 
				driver.findElement(By.xpath("//*[ contains(@src, '/VisActAccessServer/themes/athena/img/close.gif')]")).click();
				
				//Selecionando o botão Sair da Aplicação.
				driver.findElement(By.cssSelector("input[type=\"button\"]")).click();
				
				loggerDebug.debug("Teste Finalizado");
			
			}
			
		}catch(Exception erro){
			
			loggerDebug.debug("Erro ao Executar o caso de Teste: " + erro);
			loggerTestResult.testResult("Reprovado");
			loggerDebug.debug("Teste Finalizado");	
			
		}
	}
	

	@After
	public void tearDown() throws Exception {
		
		driver.quit();
		String verificationErrorString = verificationErrors.toString();
		
		if (!"".equals(verificationErrorString)) {
			
			fail(verificationErrorString);
		}
	}
	
}
